#!/usr/bin/env php
<?php declare(strict_types=1);
use function \escapeshellarg as e;

chdir( dirname(__DIR__) );

$now = new DateTime();

sys('rsync --delete -av ./vendor/nextgenthemes/wp-shared ../nextgenthemes/');
sys('composer --working-dir ../nextgenthemes/wp-shared config version ' . e( $now->format('Y.m.d.H.i.s') ) );
sys('composer update --optimize-autoloader');

function sys( string $command, array $args = [] ): ?string {

	foreach( $args as $k => $v ) {
		$command .= " --$k=" . escapeshellarg($v);
	}

	echo PHP_EOL . "Executing: $command" . PHP_EOL . PHP_EOL;

	$out = system( $command, $exit_code );

	if ( 0 !== $exit_code || false === $out ) {
		echo 'Error, output: ';
		var_dump($out);
		echo "Exit Code: $exit_code." . PHP_EOL;
		exit($exit_code);
	}

	return $out;
}
