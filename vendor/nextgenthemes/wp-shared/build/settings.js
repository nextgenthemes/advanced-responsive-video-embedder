import*as e from"@wordpress/interactivity";var t={};function o(e,t){if(n(e)&&n(t)){const o=parseInt(e),n=parseInt(t),i=s(o,n);return`${o/i}:${n/i}`}return`${e}:${t}`}function n(e){const t=Math.floor(Number(e));return t!==1/0&&String(t)===e&&t>0}function s(e,t){return t?s(t,e%t):e}t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const i=(c={getConfig:()=>e.getConfig,getContext:()=>e.getContext,store:()=>e.store},l={},t.d(l,c),l),a=new DOMParser,r=document.querySelector('[data-wp-interactive^="nextgenthemes"]')?.dataset?.wpInteractive;var c,l;if(!r)throw new Error("no namespace");const{state:d,actions:g,callbacks:p,helpers:h}=(0,i.store)(r,{state:{isValidLicenseKey:()=>{const e=(0,i.getContext)();return"valid"===d.options[e.option_key+"_status"]},is32charactersLong:()=>{const e=(0,i.getContext)();return 32===d.options[e.option_key].length},get isActiveTab(){const e=(0,i.getContext)();return!e.activeTabs||!0===e?.activeTabs[e.tab]}},actions:{toggleHelp:()=>{d.help=!d.help},openShortcodeDialog:()=>{d.dialog=document.querySelector('dialog[data-wp-interactive="nextgenthemes_arve_dialog"]'),d.dialog.showModal()},insertShortcode:()=>{window.wp.media.editor.insert(d.shortcode),d.dialog.close()},closeShortcodeDialog:()=>{d.dialog.close()},changeTab:()=>{const e=(0,i.getContext)();for(const t in e.activeTabs)e.activeTabs[t]=!1;e.activeTabs[e.tab]=!0},inputChange:e=>{const t=(0,i.getContext)(),o=e?.target instanceof HTMLInputElement,n=e?.target instanceof HTMLSelectElement;if(!o&&!n)throw new Error("event.target is not HTMLInputElement or HTMLSelectElement");"arveUrl"in e.target.dataset?h.extractFromEmbedCode(e.target.value):d.options[t.option_key]=e.target.value,"nextgenthemes_arve_dialog"!==r&&g.saveOptions()},checkboxChange:e=>{const t=(0,i.getContext)();d.options[t.option_key]=e.target.checked,"nextgenthemes_arve_dialog"!==r&&g.saveOptions()},selectImage:()=>{d.dialog&&d.dialog.close();const e=(0,i.getContext)(),t=window.wp.media({title:"Upload Image",multiple:!1}).open().on("select",(function(){const o=t.state().get("selection").first().toJSON().id;d.options[e.option_key]=o,d.dialog&&d.dialog.showModal()})).on("close",(function(){d.dialog&&d.dialog.showModal()}))},deleteOembedCache:()=>{g.restCall("/delete-oembed-cache",{delete:!0})},saveOptionsReal:()=>{g.restCall("/save",d.options)},restCall:(e,t,o=!1)=>{if(d.isSaving)return void(d.message="trying to save too fast");const n=(0,i.getConfig)();d.isSaving=!0,d.message="Saving...",fetch(n.restUrl+e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-WP-Nonce":n.nonce}}).then((e=>{if(!e.ok)throw console.log(e),new Error("Network response was not ok");return e.json()})).then((e=>{d.message=e,setTimeout((()=>d.message=""),666)})).catch((e=>{d.message=e.message})).finally((()=>{d.isSaving=!1,o&&window.location.reload()}))},eddLicenseAction(){const e=(0,i.getContext)();g.restCall("/edd-license-action",{option_key:e.option_key,edd_store_url:e.edd_store_url,edd_action:e.edd_action,item_id:e.edd_item_id,license:d.options[e.option_key]},!0)},resetOptionsSection(){const e=(0,i.getConfig)(),t=(0,i.getContext)().tab;Object.entries(e.defaultOptions).forEach((([e,o])=>{"all"===t?Object.entries(o).forEach((([e,t])=>{d.options[e]=t})):Object.entries(o).forEach((([o,n])=>{e===t&&(d.options[o]=n)}))})),g.saveOptionsReal()}},callbacks:{updateShortcode(){let e="";for(const[t,o]of Object.entries(d.options))"credentialless"===t?!1===o&&(e+=`${t}="false" `):!0===o?e+=`${t}="true" `:o&&(e+=`${t}="${o}" `);d.shortcode="[arve "+e+"/]"}},helpers:{debugJson:e=>{d.debug=JSON.stringify(e,null,2)},extractFromEmbedCode:e=>{const t=a.parseFromString(e,"text/html").querySelector("iframe"),n=t&&t.getAttribute("src");if(n&&(e=n,t.width&&t.height)){const e=o(t.width,t.height);"16:9"!==e&&(d.options.aspect_ratio=e)}d.options.url=e}}});g.saveOptions=function(e){let t;return function(...o){const n=this;clearTimeout(t),t=window.setTimeout((()=>{t=void 0,e.apply(n,o)}),1111)}}(g.saveOptionsReal);