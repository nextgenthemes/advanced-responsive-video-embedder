import*as e from"@wordpress/interactivity";var t={};function o(e,t){if(n(e)&&n(t)){const o=parseInt(e),n=parseInt(t),s=i(o,n);return`${o/s}:${n/s}`}return`${e}:${t}`}function n(e){const t=Math.floor(Number(e));return t!==1/0&&String(t)===e&&t>0}function i(e,t){return t?i(t,e%t):e}t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const s=(l={getConfig:()=>e.getConfig,getContext:()=>e.getContext,store:()=>e.store},g={},t.d(g,l),g),r=new DOMParser,a=document,c=a.querySelector.bind(a),d=c('dialog[data-wp-interactive="nextgenthemes_arve_dialog"]');var l,g;!function(){const e=c('[data-wp-interactive^="nextgenthemes"]')?.dataset?.wpInteractive;if(!e)return;const{state:t,actions:n,callbacks:i,helpers:a}=(0,s.store)(e,{state:{isValidLicenseKey:()=>{const e=(0,s.getContext)();return"valid"===t.options[e.option_key+"_status"]},is32charactersLong:()=>{const e=(0,s.getContext)();return 32===t.options[e.option_key].length},get isActiveTab(){const e=(0,s.getContext)();return!e.activeTabs||!0===e?.activeTabs[e.tab]}},actions:{toggleHelp:()=>{t.help=!t.help},openShortcodeDialog:e=>{const t=e.target instanceof HTMLElement&&e.target.dataset.editor;d&&t?(d.dataset.editor=t,d.showModal()):console.error("Dialog or editorId not found")},insertShortcode:()=>{const e=d?.dataset.editor;if(e)if("content"===e)window.wp.media.editor.insert(t.shortcode);else{if(void 0===window.tinymce||!window.tinymce.get(e))return void console.error("TinyMCE not initialized for field: "+e);window.tinymce.get(e).insertContent(t.shortcode)}else console.error("Editor ID not found");n.closeShortcodeDialog()},closeShortcodeDialog:()=>{d&&d.close()},changeTab:()=>{const e=(0,s.getContext)();for(const t in e.activeTabs)e.activeTabs[t]=!1;e.activeTabs[e.tab]=!0},inputChange:o=>{const i=(0,s.getContext)(),r=o?.target instanceof HTMLInputElement,c=o?.target instanceof HTMLSelectElement;if(!r&&!c)throw new Error("event.target is not HTMLInputElement or HTMLSelectElement");"arveUrl"in o.target.dataset?a.extractFromEmbedCode(o.target.value):t.options[i.option_key]=o.target.value,"nextgenthemes_arve_dialog"!==e&&n.saveOptions()},checkboxChange:o=>{const i=(0,s.getContext)();t.options[i.option_key]=o.target.checked,"nextgenthemes_arve_dialog"!==e&&n.saveOptions()},selectImage:()=>{d&&d.close();const e=(0,s.getContext)(),o=window.wp.media({title:"Upload Image",multiple:!1}).open().on("select",(function(){const n=o.state().get("selection").first().toJSON().id;t.options[e.option_key]=n,d&&d.showModal()})).on("close",(function(){d&&d.showModal()}))},deleteOembedCache:()=>{n.restCall("/delete-oembed-cache",{delete:!0})},saveOptionsReal:()=>{n.restCall("/save",t.options)},restCall:(e,o,n=!1)=>{if(t.isSaving)return void(t.message="trying to save too fast");const i=(0,s.getConfig)();t.isSaving=!0,t.message="Saving...",fetch(i.restUrl+e,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json","X-WP-Nonce":i.nonce}}).then((e=>{if(!e.ok)throw console.log(e),new Error("Network response was not ok");return e.json()})).then((e=>{t.message=e,setTimeout((()=>t.message=""),666)})).catch((e=>{t.message=e.message})).finally((()=>{t.isSaving=!1,n&&window.location.reload()}))},eddLicenseAction(){const e=(0,s.getContext)();n.restCall("/edd-license-action",{option_key:e.option_key,edd_store_url:e.edd_store_url,edd_action:e.edd_action,item_id:e.edd_item_id,license:t.options[e.option_key]},!0)},resetOptionsSection(){const e=(0,s.getConfig)(),o=(0,s.getContext)().tab;Object.entries(e.defaultOptions).forEach((([e,n])=>{"all"===o?Object.entries(n).forEach((([e,o])=>{t.options[e]=o})):Object.entries(n).forEach((([n,i])=>{e===o&&(t.options[n]=i)}))})),n.saveOptionsReal()}},callbacks:{updateShortcode(){let e="";for(const[o,n]of Object.entries(t.options))"credentialless"===o?!1===n&&(e+=`${o}="false" `):!0===n?e+=`${o}="true" `:n&&(e+=`${o}="${n}" `);t.shortcode="[arve "+e+"/]"}},helpers:{debugJson:e=>{t.debug=JSON.stringify(e,null,2)},extractFromEmbedCode:e=>{const n=r.parseFromString(e,"text/html").querySelector("iframe"),i=n&&n.getAttribute("src");if(i&&(e=i,n.width&&n.height)){const e=o(n.width,n.height);"16:9"!==e&&(t.options.aspect_ratio=e)}t.options.url=e}}});n.saveOptions=function(e){let t;return function(...o){const n=this;clearTimeout(t),t=window.setTimeout((()=>{t=void 0,e.apply(n,o)}),1111)}}(n.saveOptionsReal)}(),function(){const e=window.getComputedStyle(a.body).backgroundColor,t=c(".wrap--nextgenthemes");t&&t.setAttribute("style",`--ngt-wp-body-bg: ${e};`)}(),window.jQuery(document).on("click",'.arve-btn:not([data-editor="content"])',(e=>{e.preventDefault();const t=c('[data-wp-on--click="actions.openShortcodeDialog"][data-editor="content"]'),o=c('[data-wp-on--click="actions.insertShortcode"]');t&&o&&d?t.dispatchEvent(new Event("click")):console.error("Open btn, insert btn od dialog not found")}));