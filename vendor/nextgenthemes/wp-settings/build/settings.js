import{getConfig as e,getContext as t,store as o}from"@wordpress/interactivity";function n(e,t){if(i(e)&&i(t)){const o=parseInt(e),n=parseInt(t),i=s(o,n);return`${o/i}:${n/i}`}return`${e}:${t}`}function i(e){const t=Math.floor(Number(e));return t!==1/0&&String(t)===e&&t>0}function s(e,t){return t?s(t,e%t):e}const a=new DOMParser,r=document,c=r.querySelector.bind(r),l=c('dialog[data-wp-interactive="nextgenthemes_arve_dialog"]');!function(){const i=c('[data-wp-interactive^="nextgenthemes"]')?.dataset?.wpInteractive;if(!i)return;const{state:s,actions:r,callbacks:d,helpers:p}=o(i,{state:{isValidLicenseKey:()=>{const e=t();return"valid"===s.options[e.option_key+"_status"]},is32charactersLong:()=>{const e=t();return 32===s.options[e.option_key].length},get isActiveTab(){const e=t();return!e.activeTabs||!0===e?.activeTabs[e.tab]}},actions:{toggleHelp:()=>{s.help=!s.help},openShortcodeDialog:e=>{const t=e.target instanceof HTMLElement&&e.target.dataset.editor;l&&t?(l.dataset.editor=t,l.showModal()):console.error("Dialog or editorId not found")},insertShortcode:()=>{const e=l?.dataset.editor;if(e)if("content"===e)window.wp.media.editor.insert(s.shortcode);else{if(void 0===window.tinymce||!window.tinymce.get(e))return void console.error("TinyMCE not initialized for field: "+e);window.tinymce.get(e).insertContent(s.shortcode)}else console.error("Editor ID not found");r.closeShortcodeDialog()},closeShortcodeDialog:()=>{l&&l.close()},changeTab:()=>{const e=t();for(const t in e.activeTabs)e.activeTabs[t]=!1;e.activeTabs[e.tab]=!0},inputChange:e=>{const o=t(),n=e?.target instanceof HTMLInputElement,a=e?.target instanceof HTMLSelectElement;if(!n&&!a)throw new Error("event.target is not HTMLInputElement or HTMLSelectElement");"arveUrl"in e.target.dataset?p.extractFromEmbedCode(e.target.value):s.options[o.option_key]=e.target.value,"nextgenthemes_arve_dialog"!==i&&r.saveOptions()},checkboxChange:e=>{const o=t();s.options[o.option_key]=e.target.checked,"nextgenthemes_arve_dialog"!==i&&r.saveOptions()},selectImage:()=>{l&&l.close();const e=t(),o=window.wp.media({title:"Upload Image",multiple:!1}).open().on("select",function(){const t=o.state().get("selection").first().toJSON().id;s.options[e.option_key]=t,l&&l.showModal()}).on("close",function(){l&&l.showModal()})},deleteCaches:()=>{const e=t();r.restCall("/delete-caches",{type:e.type,prefix:e.prefix,like:e.like,not_like:e.type,delete_option:e.delete_option})},saveOptionsReal:()=>{r.restCall("/save",s.options)},restCall:(t,o,n=!1)=>{if(s.isSaving)return void(s.message="trying to save too fast");const i=e();s.isSaving=!0,s.message="Saving...",fetch(i.restUrl+t,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json","X-WP-Nonce":i.nonce}}).then(e=>{if(!e.ok)throw console.log(e),new Error("Network response was not ok");return e.json()}).then(e=>{s.message=e,setTimeout(()=>s.message="",666)}).catch(e=>{s.message=e.message}).finally(()=>{s.isSaving=!1,n&&window.location.reload()})},eddLicenseAction(){const e=t();r.restCall("/edd-license-action",{option_key:e.option_key,edd_store_url:e.edd_store_url,edd_action:e.edd_action,item_id:e.edd_item_id,license:s.options[e.option_key]},!0)},resetOptionsSection(){const o=e(),n=t().tab;Object.entries(o.defaultOptions).forEach(([e,t])=>{"all"===n?Object.entries(t).forEach(([e,t])=>{s.options[e]=t}):Object.entries(t).forEach(([t,o])=>{e===n&&(s.options[t]=o)})}),r.saveOptionsReal()}},callbacks:{updateShortcode(){let e="";for(const[t,o]of Object.entries(s.options))"credentialless"===t?!1===o&&(e+=`${t}="false" `):!0===o?e+=`${t}="true" `:o&&(e+=`${t}="${o}" `);s.shortcode="[arve "+e+"/]"}},helpers:{debugJson:e=>{s.debug=JSON.stringify(e,null,2)},extractFromEmbedCode:e=>{const t=a.parseFromString(e,"text/html").querySelector("iframe"),o=t&&t.getAttribute("src");if(o&&(e=o,t.width&&t.height)){const e=n(t.width,t.height);"16:9"!==e&&(s.options.aspect_ratio=e)}s.options.url=e}}});r.saveOptions=function(e){let t;return function(...o){const n=this;clearTimeout(t),t=window.setTimeout(()=>{t=void 0,e.apply(n,o)},1111)}}(r.saveOptionsReal)}(),function(){const e=window.getComputedStyle(r.body).backgroundColor,t=c(".wrap--nextgenthemes");t&&t.setAttribute("style",`--ngt-wp-body-bg: ${e};`)}(),window.jQuery(document).on("click",'.arve-btn:not([data-editor="content"])',e=>{e.preventDefault();const t=c('[data-wp-on--click="actions.openShortcodeDialog"][data-editor="content"]'),o=c('[data-wp-on--click="actions.insertShortcode"]');t&&o&&l?t.dispatchEvent(new Event("click")):console.error("Open btn, insert btn od dialog not found")});